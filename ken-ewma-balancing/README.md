# SDN-контроллер с учётом самоподобия трафика (OSKen, OpenFlow 1.3)

## Общее описание

Контроллер реализован с использованием фреймворка **OSKen (Ryu)** и управляет маршрутизацией и мониторингом OpenFlow-коммутатора. Он использует адаптивную стратегию на основе **EWMA** (Exponentially Weighted Moving Average) для анализа сетевого трафика и учёта **самоподобия** (self-similarity).



## Компоненты контроллера

### Используемые технологии:
- **OSKen (OpenFlow контроллер)**
- **OpenFlow 1.3**
- **OFPFlowMod** – установка правил
- **OFPPortStatsRequest** / **Reply** – мониторинг нагрузки на портах
- **EWMA-фильтр** – для сглаживания всплесков


## Логика работы контроллера

### 1. Инициализация

В `__init__()`:
- задаётся **маршрутная таблица** `self.routing_tables` — сопоставление IP с портами и MAC-адресами;
- инициализируется **хранилище статистики** по портам (`last_bytes`, `ewma`);
- запускается цикл мониторинга портов через `hub.spawn(self._monitor)`.



### 2. Установка маршрутов при подключении коммутатора

При срабатывании события `EventOFPSwitchFeatures`:
- контроллер получает `datapath` и `dpid` коммутатора;
- если `dpid` есть в `routing_tables`, то для каждого IP:
  - создаётся `OFPMatch` по `ipv4_dst`;
  - добавляется действие `set_field(eth_dst)` и `output(port)`;
  - устанавливается правило через `OFPFlowMod`.


### 3. Обработка входящих пакетов (`packet_in_handler`)

При получении `Packet-In`:
- контроллер извлекает `eth`, `ipv4`;
- логирует IP-адрес назначения;
- применяет **флудинг** (если нет точного совпадения) через `OFPP_FLOOD`.


### 4. Мониторинг портов (`_monitor` и `port_stats_reply_handler`)

#### Цикл мониторинга (`_monitor`):
- каждые 1 секунда отправляется `OFPPortStatsRequest` на все datapath'ы.

#### Обработка `PortStatsReply`:
- для интересующих портов (например, `port 3` и `port 4`) рассчитывается:
  - разница в `tx_bytes` с прошлого измерения;
  - применяем EWMA-фильтр:

```python
ewma[port] = alpha * delta + (1 - alpha) * ewma[port]
```

- если **EWMA превышает порог**, фиксируется перегрузка порта:

```python
if ewma[port] > threshold:
    log: "[ALERT] Port X is congested"
```


## Конфигурационные параметры

| Параметр          | Описание                                         | Значение по умолчанию |
|-------------------|--------------------------------------------------|------------------------|
| `alpha`           | коэффициент EWMA-фильтра                         | `0.3`                  |
| `port_threshold`  | порог перегрузки в байтах/сек                    | `1_000_000` (1 MB/s)   |
| `monitor_interval`| период опроса портов                             | `1 секунда`            |



## Возможности расширения

- **Автоматическое управление маршрутами**:
  - исключение перегруженных портов из групповых таблиц;
  - временное изменение `OFPGroupMod` при перегрузке.
- **Интеграция с ML**:
  - прогнозирование трафика;
  - классификация всплесков.
- **Визуализация** (опционально):
  - в отдельном GUI, Web-интерфейсе или Prometheus+Grafana.



## Вывод

Контроллер реализует интеллектуальную адаптацию под свойства **реального трафика**, включая самоподобие. Это приближает поведение SDN-сети к **производственным сценариям**, где простая round-robin балансировка не справляется с пиками нагрузки.
